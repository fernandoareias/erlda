<svg viewBox="0 0 1800 800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>
  
  <!-- Actors -->
  <rect x="50" y="50" width="100" height="40" fill="#e1f5fe" stroke="#01579b" rx="5"/>
  <text x="100" y="75" text-anchor="middle" font-family="Arial" font-size="12">Cliente</text>
  
  <rect x="200" y="50" width="120" height="40" fill="#e8f5e8" stroke="#2e7d32" rx="5"/>
  <text x="260" y="75" text-anchor="middle" font-family="Arial" font-size="12">http_server</text>
  
  <rect x="370" y="50" width="140" height="40" fill="#fff3e0" stroke="#ef6c00" rx="5"/>
  <text x="440" y="75" text-anchor="middle" font-family="Arial" font-size="12">parser_stage</text>
  
  <rect x="560" y="50" width="130" height="40" fill="#f3e5f5" stroke="#7b1fa2" rx="5"/>
  <text x="625" y="75" text-anchor="middle" font-family="Arial" font-size="12">cache_stage</text>
  
  <rect x="740" y="50" width="120" height="40" fill="#e0f2f1" stroke="#00695c" rx="5"/>
  <text x="800" y="75" text-anchor="middle" font-family="Arial" font-size="12">get_stage</text>
  
  <rect x="910" y="50" width="150" height="40" fill="#fce4ec" stroke="#c2185b" rx="5"/>
  <text x="985" y="75" text-anchor="middle" font-family="Arial" font-size="12">response_writer</text>
  
  <!-- Lifelines -->
  <line x1="100" y1="90" x2="100" y2="700" stroke="#666" stroke-width="2"/>
  <line x1="260" y1="90" x2="260" y2="700" stroke="#666" stroke-width="2"/>
  <line x1="440" y1="90" x2="440" y2="700" stroke="#666" stroke-width="2"/>
  <line x1="625" y1="90" x2="625" y2="700" stroke="#666" stroke-width="2"/>
  <line x1="800" y1="90" x2="800" y2="700" stroke="#666" stroke-width="2"/>
  <line x1="985" y1="90" x2="985" y2="700" stroke="#666" stroke-width="2"/>
  
  <!-- Messages -->
  <line x1="100" y1="120" x2="260" y2="120" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="180" y="115" text-anchor="middle" font-family="Arial" font-size="10">HTTP Request</text>
  
  <line x1="260" y1="150" x2="440" y2="150" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="350" y="145" text-anchor="middle" font-family="Arial" font-size="9">{command, {parse_request, Data, Socket}, Pid}</text>
  
  <line x1="440" y1="180" x2="625" y2="180" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="532" y="175" text-anchor="middle" font-family="Arial" font-size="9">{forward, cache_stage, {get, Path, Socket}}</text>
  
  <!-- Cache hit path (alternative) -->
  <line x1="625" y1="200" x2="985" y2="200" stroke="#333" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <text x="805" y="195" text-anchor="middle" font-family="Arial" font-size="9">Cache Hit: {forward, response_writer, {Socket, "200 OK", "text/html", Content}}</text>
  
  <!-- Alternative path indicator -->
  <text x="805" y="185" text-anchor="middle" font-family="Arial" font-size="8" fill="#666">(pula get_stage)</text>
  
  <!-- Cache miss path -->
  <line x1="625" y1="220" x2="800" y2="220" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="712" y="215" text-anchor="middle" font-family="Arial" font-size="9">Cache Miss: {forward, get_stage, {Path, Socket}}</text>
  
  <line x1="800" y1="250" x2="625" y2="250" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="712" y="245" text-anchor="middle" font-family="Arial" font-size="9">{forward, cache_stage, {put_and_respond, Path, Socket, Status, ContentType, Body}}</text>
  
  <line x1="625" y1="280" x2="985" y2="280" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="805" y="275" text-anchor="middle" font-family="Arial" font-size="9">{forward, response_writer, {Socket, Status, ContentType, Body}}</text>
  
  <line x1="985" y1="320" x2="100" y2="320" stroke="#333" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <text x="542" y="315" text-anchor="middle" font-family="Arial" font-size="10">HTTP Response (gen_tcp:send)</text>
  
  <!-- Activation boxes -->
  <rect x="250" y="110" width="20" height="220" fill="#e3f2fd" stroke="#1976d2" opacity="0.7"/>
  <rect x="430" y="140" width="20" height="50" fill="#fff8e1" stroke="#f57c00" opacity="0.7"/>
  <rect x="615" y="170" width="20" height="120" fill="#f1f8e9" stroke="#388e3c" opacity="0.7"/>
  <rect x="790" y="210" width="20" height="50" fill="#e8f5e8" stroke="#2e7d32" opacity="0.7"/>
  <rect x="975" y="190" width="20" height="100" fill="#fce4ec" stroke="#c2185b" opacity="0.7"/>
  
</svg>
